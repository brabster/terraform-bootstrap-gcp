# syntax=docker/dockerfile:1
#
# Test Dockerfile to verify proxy certificate installation works
# This uses a stable Ubuntu release to avoid unrelated package availability issues

FROM docker.io/ubuntu:24.04

COPY scripts/ /tmp/scripts/

# Install proxy certificate if provided
# Use: docker build --secret id=proxy_cert,src=/path/to/cert.pem ...
RUN --mount=type=secret,id=proxy_cert,required=false \
    chmod +x /tmp/scripts/* \
    && if [ -f /run/secrets/proxy_cert ]; then \
        /tmp/scripts/install_proxy_cert.sh /run/secrets/proxy_cert; \
    else \
        /tmp/scripts/install_proxy_cert.sh ""; \
    fi \
    && apt-get update \
    && apt-get install -y --no-install-recommends wget gnupg ca-certificates \
    && /tmp/scripts/test_proxy_cert.sh \
    && rm -rf /var/lib/apt/lists/*

CMD ["/bin/bash"]
